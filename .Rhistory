gc()
source("C:/Users/TBRUSH/R/HR_Analysis_Elk2022/00_TelemDataPrep.R", echo=TRUE)
#####################################################################################
# 01_MCP.R
# script to run MCPs
# following from 00_TelemDataPrep.R
# adapted from script written by genevieve perkins (genevieve.perkins@gov.bc.ca)
# modified by Joanna Burgar (Joanna.Burgar@gov.bc.ca) - 06-Oct-2019
#####################################################################################
.libPaths("C:/Program Files/R/R-4.2.0/library") # to ensure reading/writing libraries from C drive (H drive too slow)
# run libraries
library(bcmaps)
library(dplyr)
library(ggplot2)
library(Cairo)
library(sf)
library(sp)
library(adehabitatHR)
# set up working directories
InputDir <- c("C:/Users/TBRUSH/R/HR_Analysis_Elk2022/Input")
OutputDir <- c("C:/Users/TBRUSH/R/HR_Analysis_Elk2022/Output")
##############################################################
#### LOAD and REVIEW DATA (BEGINNING)
#############################################################
## load data into R
setwd(InputDir)
load("HR_InputData.RData")
# review spatial object data - check to see if loaded properly
st_geometry(HR.sf) # currently in WGS84 CRS, lat/long
HR.sf$AnimalID <- as.factor(HR.sf$AnimalID)
names(HR.sf)
summary(HR.sf)
# plot to check
# check the spread of elk with mapped locations
bc <- bc_bound()
SC <- nr_districts() %>% filter(ORG_UNIT %in% c("DCK", "DSQ", "DSC"))
# Plot by AnimalID (104 individuals)
unique(HR.sf$AnimalID)
ggplot() +
geom_sf(data=SC, fill="white", col="gray") +
geom_sf(data=HR.sf, aes(fill=AnimalID, col=AnimalID))+
coord_sf() +
theme_minimal() +
ggtitle("Animal GPS locations")
###--- Change to a SpatialPointsDataFrame and set to utm (m units)
HR.sf.AS_utm <- st_transform(HR.sf.AS, crs=26910) # utm and m units
HR.sf.AS_utm$geometry
HR.sp.AS <- as(HR.sf.AS_utm, "Spatial")
class(HR.sp.AS)
# Calculate MCPs for each animal season
names(HR.sp.AS)
ASmcp.95 <- mcp(HR.sp.AS[,c("Animal_Season")], percent = 95)
ASmcp.50 <- mcp(HR.sp.AS[,c("Animal_Season")], percent = 50)
# Plot
plot(HR.sp.AS) # looks similar to before
plot(ASmcp.95, col = alpha(1:73, 0.5), add = TRUE)
plot(ASmcp.50, col = alpha(1:73, 0.5), add = TRUE)
source("C:/Users/TBRUSH/R/HR_Analysis_Elk2022/00_TelemDataPrep.R", echo=TRUE)
#####################################################################################
# 01_MCP.R
# script to run MCPs
# following from 00_TelemDataPrep.R
# adapted from script written by genevieve perkins (genevieve.perkins@gov.bc.ca)
# modified by Joanna Burgar (Joanna.Burgar@gov.bc.ca) - 06-Oct-2019 and Tristen Brush (tristen.brush@gov.bc.ca) - July 2022
#####################################################################################
.libPaths("C:/Program Files/R/R-4.2.0/library") # to ensure reading/writing libraries from C drive (H drive too slow)
# run libraries
library(bcmaps)
library(dplyr)
library(ggplot2)
library(Cairo)
library(sf)
library(sp)
library(adehabitatHR)
# set up working directories
InputDir <- c("C:/Users/TBRUSH/R/HR_Analysis_Elk2022/Input")
OutputDir <- c("C:/Users/TBRUSH/R/HR_Analysis_Elk2022/Output")
##############################################################
#### LOAD and REVIEW DATA (BEGINNING)
#############################################################
## load data into R
setwd(InputDir)
load("HR_InputData.RData")
# review spatial object data - check to see if loaded properly
st_geometry(HR.sf) # currently in WGS84 CRS, lat/long
HR.sf$AnimalID <- as.factor(HR.sf$AnimalID)
names(HR.sf)
summary(HR.sf)
# plot to check
# check the spread of elk with mapped locations
bc <- bc_bound()
SC <- nr_districts() %>% filter(ORG_UNIT %in% c("DCK", "DSQ", "DSC"))
# Plot by AnimalID (104 individuals)
unique(HR.sf$AnimalID)
ggplot() +
geom_sf(data=SC, fill="white", col="gray") +
geom_sf(data=HR.sf, aes(fill=AnimalID, col=AnimalID))+
coord_sf() +
theme_minimal() +
ggtitle("Animal GPS locations")
# Plot by Animal_Season (183 animal_seasons)
unique(HR.sf.AS$Animal_Season)
ggplot() +
geom_sf(data=SC, fill="white", col="gray") +
geom_sf(data=HR.sf.AS, aes(fill=Animal_Season, col=Animal_Season))+
coord_sf() +
theme_minimal() +
ggtitle("Animal_Season GPS locations")
# Plot by season
unique(HR.sf$Season)
ggplot() +
geom_sf(data=SC, fill="white", col="gray") +
geom_sf(data=HR.sf, aes(fill=Season, col=Season))+
coord_sf() +
theme_minimal() +
ggtitle("Seasonal GPS locations")
# Plot by Animal_Year (271 individuals)
unique(HR.sf.AY$Animal_Year)
ggplot() +
geom_sf(data=SC, fill="white", col="gray") +
geom_sf(data=HR.sf.AY, aes(fill=Animal_Year, col=Animal_Year))+
coord_sf() +
theme_minimal() +
ggtitle("Animal_Year GPS locations")
View(HR.sf)
# Plot by year
unique(HR.sf$Year)
ggplot() +
geom_sf(data=SC, fill="white", col="gray") +
geom_sf(data=HR.sf, aes(fill=Year, col=Year))+
coord_sf() +
theme_minimal() +
ggtitle("Yearly GPS locations")
###--- Change to a SpatialPointsDataFrame and set to utm (m units)
HR.sf.AS_utm <- st_transform(HR.sf.AS, crs=26910) # utm and m units
HR.sf.AS_utm$geometry
HR.sp.AS <- as(HR.sf.AS_utm, "Spatial")
class(HR.sp.AS)
# Calculate MCPs for each animal season
names(HR.sp.AS)
ASmcp.95 <- mcp(HR.sp.AS[,c("Animal_Season")], percent = 95)
ASmcp.50 <- mcp(HR.sp.AS[,c("Animal_Season")], percent = 50)
# Plot
plot(HR.sp.AS) # looks similar to before
plot(ASmcp.95, col = alpha(1:73, 0.5), add = TRUE)
plot(ASmcp.50, col = alpha(1:73, 0.5), add = TRUE)
# create shapefiles
# add in meta data covariates
head(HR.df)
ASmcp.95.sf <- st_as_sf(ASmcp.95)
colnames(ASmcp.95.sf)[1] <- "Animal_Season" # change id back to Animal_Season
ASmcp.95.sf <- dplyr::left_join(ASmcp.95.sf,
HR.df[c("Animal_Season","AnimalID","Group.New","Season","Species","Sex", "Age_Class")],
by = "Animal_Season")
colnames(ASmcp.95.sf)[1] <- "Animal_Season" # change id back to Animal_Season
ASmcp.95.sf <- dplyr::left_join(ASmcp.95.sf,
HR.df[c("Animal_Season","AnimalID","Season","Species","Sex", "Age_Class")],
by = "Animal_Season")
View(HR.df)
View(HR.df)
View(HR.sf)
ASmcp.95.sf <- st_as_sf(ASmcp.95)
View(ASmcp.95.sf)
View(HR.df)
View(HR.sf)
source("C:/Users/TBRUSH/R/HR_Analysis_Elk2022/00_TelemDataPrep.R", echo=TRUE)
# select relevant records
anml.full <- Elk_metadata %>%
mutate(CollarID = as.numeric(`Serial No.`)) %>%
filter(Make == "Vectronics",
Species == "Roosevelt elk",
CollarID >= 22585)
View(anml.full)
anml.full <- anml.full %>%
mutate(AnimalID = as.numeric(row.names(anml.full)),
Cptr_Northing = as.numeric(`Northing (capture)`),
Cptr_Easting = as.numeric(`Easting (capture)`),
Species = as.factor(Species),
Sex = as.factor(Sex)) %>%
select(AnimalID,
CollarID,
Species,
Sex,
Age_Class = `Age Class`,
Comments,
Cptr_EPU = `Population Unit`,
Cptr_Northing,
Cptr_Easting,
Cptr_UTM = `UTM Zone (capture)`,
Cptr_Date = Date,
Cptr_Time = Time,
Rls_Date = `Release Date`,
Rls_Time = `Release Time`,
Rls_EPU = `Population Unit (release)`,
Cptr_Method = `Capture Method`,
Drug = `Immobilization Drug`,
Volume = Volume...43,
`Tick Hair Loss`:Teeth)
anml.full <- anml.full %>%
mutate(AnimalID = as.numeric(row.names(anml.full)),
Cptr_Northing = as.numeric(`Northing (capture)`),
Cptr_Easting = as.numeric(`Easting (capture)`),
Species = as.factor(Species),
Sex = as.factor(Sex))
anml.full <- anml.full %>%
mutate(AnimalID = as.numeric(row.names(anml.full)),
Cptr_Northing = as.numeric(`Northing (capture)`),
Cptr_Easting = as.numeric(`Easting (capture)`),
Species = as.factor(Species),
Sex = as.factor(Sex)) %>%
select(AnimalID,
CollarID,
Species,
Sex,
Age_Class = `Age Class`,
Comments,
Cptr_EPU = `Population Unit`,
Cptr_Northing,
Cptr_Easting,
Cptr_UTM = `UTM Zone (capture)`,
Cptr_Date = Date,
Cptr_Time = Time,
Rls_Date = `Release Date`,
Rls_Time = `Release Time`,
Rls_EPU = `Population Unit (release)`,
Cptr_Method = `Capture Method`,
Drug = `Immobilization Drug`,
Volume = Volume...43,
`Tick Hair Loss`:Teeth)
source("C:/Users/TBRUSH/R/HR_Analysis_Elk2022/00_TelemDataPrep.R", echo=TRUE)
anml.full1 <- anml.full %>%
mutate(AnimalID = as.numeric(row.names(anml.full)),
Cptr_Northing = as.numeric(`Northing (capture)`),
Cptr_Easting = as.numeric(`Easting (capture)`),
Species = as.factor(Species),
Sex = as.factor(Sex)) %>%
select(AnimalID,
CollarID,
Species,
Sex,
Age_Class = `Age Class`,
Comments,
Cptr_EPU = `Population Unit`,
Cptr_Northing,
Cptr_Easting,
Cptr_UTM = `UTM Zone (capture)`,
Cptr_Date = Date,
Cptr_Time = Time,
Rls_Date = `Release Date`,
Rls_Time = `Release Time`,
Rls_EPU = `Population Unit (release)`,
Cptr_Method = `Capture Method`,
Drug = `Immobilization Drug`,
Volume = Volume...43,
`Tick Hair Loss`:Teeth)
anml.full1 <- anml.full %>%
# mutate(AnimalID = as.numeric(row.names(anml.full)),
#        Cptr_Northing = as.numeric(`Northing (capture)`),
#        Cptr_Easting = as.numeric(`Easting (capture)`),
#        Species = as.factor(Species),
#        Sex = as.factor(Sex)) %>%
select(AnimalID,
CollarID,
Species,
Sex,
Age_Class = `Age Class`,
Comments,
Cptr_EPU = `Population Unit`,
Cptr_Northing,
Cptr_Easting,
Cptr_UTM = `UTM Zone (capture)`,
Cptr_Date = Date,
Cptr_Time = Time,
Rls_Date = `Release Date`,
Rls_Time = `Release Time`,
Rls_EPU = `Population Unit (release)`,
Cptr_Method = `Capture Method`,
Drug = `Immobilization Drug`,
Volume = Volume...43,
`Tick Hair Loss`:Teeth)
View(anml.full)
anml.full1 <- anml.full %>%
mutate(AnimalID = as.numeric(row.names(anml.full)),
Cptr_Northing = as.numeric(`Northing (capture)`),
Cptr_Easting = as.numeric(`Easting (capture)`),
Species = as.factor(Species),
Sex = as.factor(Sex))
View(anml.full1)
#####################################################################################
# 00_TelemDataPrep.R
# script to prepare telemetry data for running home range analyses
# written by Joanna Burgar (Joanna.Burgar@gov.bc.ca) - 04-Oct-2019
#####################################################################################
.libPaths("C:/Program Files/R/R-4.2.0/library") # to ensure reading/writing libraries from C drive (H drive too slow)
# run libraries
library(ggplot2)    # for plotting
library(dbplyr)  # for data manipulation
library(stringr)    # for formatting character data
library(lubridate)  # for date-time conversions
library(sf)         # for uploading shapefiles and working with sf objects
library(sp)         # for changing lat/long to UTM
library(rgdal)
library(tidyverse)
# set up working directories
InputDir <- c("C:/Users/TBRUSH/R/HR_Analysis_Elk2022/Input")
OutputDir <- c("C:/Users/TBRUSH/R/HR_Analysis_Elk2022/Output")
##############################################################
#### METADATA EXPLORATION & FORMATTING (BEGINNING)
#############################################################
## load data into R
setwd(InputDir)
###--- upload animal and collar metadata files
Elk_metadata <- read_csv("Capture and Telemetry_DATABASE_April 29_2022 (version 1).csv")
# select relevant records
anml.full <- Elk_metadata %>%
mutate(CollarID = as.numeric(`Serial No.`)) %>%
filter(Make == "Vectronics",
Species == "Roosevelt elk",
CollarID >= 22585)
anml.full1 <- anml.full %>%
mutate(AnimalID = as.numeric(row.names(anml.full)),
Cptr_Northing = as.numeric(`Northing (capture)`),
Cptr_Easting = as.numeric(`Easting (capture)`),
Species = as.factor(Species),
Sex = as.factor(Sex)) %>%
select(AnimalID,
CollarID,
Species,
Sex,
Age_Class = `Age Class`,
Comments,
Cptr_EPU = `Population Unit`,
Cptr_Northing,
Cptr_Easting,
Cptr_UTM = `UTM Zone (capture)`,
Cptr_Date = Date,
Cptr_Time = Time,
Rls_Date = `Release Date`,
Rls_Time = `Release Time`,
Rls_EPU = `Population Unit (release)`,
Cptr_Method = `Capture Method`,
Drug = `Immobilization Drug`,
Volume = Volume...43,
`Tick Hair Loss`:Teeth)
source("C:/Users/TBRUSH/R/HR_Analysis_Elk2022/00_TelemDataPrep.R", echo=TRUE)
source("C:/Users/TBRUSH/R/HR_Analysis_Elk2022/00_TelemDataPrep.R", echo=TRUE)
source("C:/Users/TBRUSH/R/HR_Analysis_Elk2022/01_MCP.R", echo=TRUE)
